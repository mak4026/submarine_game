# SimplePlayer(ai_player_simple.rb)

## プレイヤーの特徴
Random Playerとは異なる点
- 自分の砲撃によって得た情報と敵の砲撃と移動から得た情報から、敵艦の位置を絞り込む
- 攻撃を行う場合は、基本的に敵艦が絶対に存在しない座標には砲撃をしない
なお、移動するか攻撃するかはRandom Playerと同様に、ランダムに選択される。

## 実装の方法について

### 敵艦の場所の管理
SimplePlayerクラスのインスタンス変数@enemy_fieldに敵艦("w","c","s")のそれぞれについて、存在する可能性がある座標を格納する行列を保存しておく。

例: 
"w"が[0,0],[0,1],[0,2]、"c"が[1,1]、"s"が[3,4],[4,4]のいずれかにいる場合
```ruby
@enemy_field = {
                 "w" => [[0,0],[0,1],[0,2]],
                 "c" => [[1,1]],
                 "s" => [[3,4],[4,4]]
               }
```
敵艦が沈没している場合、@enemy_fieldから沈没した艦のキーは除外される。
例: 
"c"が沈没している場合
```ruby
@enemy_field = {
                 "w" => [[0,0],[0,1],[0,2]],
                 "s" => [[3,4],[4,4]]
               }
```

### update
updateメソッドが呼ばれると、受け取ったjsonデータから敵艦の情報を更新する。詳しい実装はコードにコメントを記載しているが、

- 自分のターンに、敵艦に攻撃をヒットさせた場合は、敵艦1隻について座標が確定する
- 自分のターンに、敵艦へ至近弾を打った場合は、攻撃した座標の周囲**8マス**に、nearに含まれる艦が必ず存在する
- 敵艦が移動した場合は、移動した差分の分だけ敵艦の存在範囲も同じだけ平行移動する

の3つの方法を用いて敵艦の位置を更新している。

### action
- 移動か攻撃かをランダムに選択する
  1. 移動する場合はランダムな艦をランダムな場所に移動させる
  2. 攻撃する場合
    1. 攻撃する敵艦をランダムに選択する
    2. 選択した艦の存在範囲からランダムに1つ座標を選択する
    3. 選んだ座標が自軍の射程圏内の座標でなかった場合、ひとつ前に戻って選びなおす（一定回数まで）
    4. 攻撃可能なら攻撃を決定
    5. 未だ射程圏外の座標を攻撃しようとしていた場合は、フィールド内の射程圏内の座標をランダムで選択し攻撃

* * *

# StatePlayer(state_player.rb)

## プレイヤーの特徴
ai_player_simple.rbとの違い

- プレイヤーが状態を持っている。
- 状態に応じて行動を変化する

また、状態を持つだけでなく、それぞれの状態においてより賢い行動を選択するようにした。

## 実装の方法について

### 状態について

StatePlayerクラスのインスタンス変数@stateに:attack,:chase,:escapeの3つの状態を保存する。それぞれの大まかな動作は以下の通り。

- :attack
    - 通常の状態。敵艦が存在する可能性があるマスを攻撃する。
        - 集中狙いモード(後述)の場合は、特定の艦を優先的に狙う
        - それ以外の場合は、ランダムに攻撃艦を選択
    - 自軍の射程範囲内に、敵艦が存在しなさそうならば、:chaseに状態を切り替える
- :chase
    - 自軍の艦をランダムに選択する。
    - 集中狙いモードの時は特定の艦を、そうでないときはランダムに選んだ敵艦に近づくように動く
    - 一度動く度に:attackに状態を戻す
- :escape
    - 前ターンに攻撃を食らった艦を動かす。
    - 絶対安全な座標に動かせそうならば、動かす
    - そうでないならば、フィールド上のランダムな位置に動かす

### 集中狙いモード

クラスのインスタンス変数@focus(default値 = nil)に特定の艦が入っている場合、:attack,:chase時にその艦を優先的に狙ったリ追いかけたりする。
次のときに@focusは更新される

- 自ターンに敵艦に攻撃を命中させたとき
    - 敵艦が生き残ってる場合は、その艦を@focusに格納
    - 敵艦を沈没させた場合は、@focus = nil とする
- 敵ターンに攻撃を食らった場合
    - 攻撃を食らった自軍艦の周囲に、存在位置が明らかな敵艦がいる場合、かつ、その艦のHPが攻撃を受けた自軍艦のHP以下の場合は、@focusに該当する敵艦を格納する
    - つまり、殴られた場合、殴り返せそうならば、反撃する

詳細な挙動については、ソースコード中にコメントを付記してある
